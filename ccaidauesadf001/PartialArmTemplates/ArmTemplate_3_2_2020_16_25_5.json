{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "ccaidauesadf001"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/GDM Photo Taking')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "DataFlow_GDMPhotoTaking",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "DataFlow_GDMPhotoTaking",
								"type": "DataFlowReference",
								"datasetParameters": {
									"SurveyTransaction": {
										"table": "vwADF_GDMPhotoTaking",
										"secret": "azure-sql-dev-survey"
									},
									"Customers": {
										"table": "vwADF_Customers",
										"secret": "azure-sql-dev-masterdata"
									},
									"SinkToData": {
										"table": "GDMPhotoTaking",
										"secret": "azure-sql-dev-eds"
									}
								}
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							}
						}
					}
				],
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/DataFlow_GDMPhotoTaking')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DataFlow_GDMPhotoTaking')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "GenericAzureSQLDatabase",
								"type": "DatasetReference"
							},
							"name": "SurveyTransaction"
						},
						{
							"dataset": {
								"referenceName": "GenericAzureSQLDatabase",
								"type": "DatasetReference"
							},
							"name": "Customers"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "GenericAzureSQLDatabase",
								"type": "DatasetReference"
							},
							"name": "SinkToData"
						}
					],
					"transformations": [
						{
							"name": "JoinToCustomer"
						}
					],
					"script": "source(output(\n\t\tSurveyTransactionId as long,\n\t\tApplicationSourceId as integer,\n\t\tGuid as string,\n\t\tSurveyId as integer,\n\t\tSurveyDescription as string,\n\t\tStartSurveyDateTime as string,\n\t\tCustomerNumber as string,\n\t\tQ01 as string,\n\t\tQ02 as string,\n\t\tQ03 as string,\n\t\tQ04 as string,\n\t\tQ05 as string,\n\t\tQ06 as string,\n\t\tQ07 as string,\n\t\tQ08 as string,\n\t\tQ09 as string,\n\t\tQ10 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select * from vwADF_GDMPhotoTaking\\n',\n\tformat: 'query') ~> SurveyTransaction\nsource(output(\n\t\tNumber as string,\n\t\tName as string,\n\t\tBasisNumber as string,\n\t\tStreet as string,\n\t\tSubTradeChannelID as string,\n\t\tTradeNameID as string,\n\t\tOperationalRegionID as string,\n\t\tMarketTypeID as string,\n\t\tCACCustomer as string,\n\t\tDirectIndicator as string,\n\t\tIsActive as boolean,\n\t\tSR_CODE as string,\n\t\tSR_Name as string,\n\t\tDSM_Code as string,\n\t\tDSM_Name as string,\n\t\tSM_Code as string,\n\t\tSM_Name as string,\n\t\tGM_Code as string,\n\t\tGM_Name as string,\n\t\tGM_Desc as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select * from vwADF_EdsGdmCustomers',\n\tformat: 'query') ~> Customers\nSurveyTransaction, Customers join(CustomerNumber == Number,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinToCustomer\nJoinToCustomer sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\trecreate:true,\n\tformat: 'table',\n\tmapColumn(\n\t\tSurveyTransactionId,\n\t\tApplicationSourceId,\n\t\tGuid,\n\t\tSurveyId,\n\t\tSurveyDescription,\n\t\tStartSurveyDateTime,\n\t\tQ01,\n\t\tQ02,\n\t\tQ03,\n\t\tQ04,\n\t\tQ05,\n\t\tQ06,\n\t\tQ07,\n\t\tQ08,\n\t\tQ09,\n\t\tQ10,\n\t\tOutletNumber = Number,\n\t\tOutletName = Name,\n\t\tBasisNumber,\n\t\tStreet,\n\t\tSubTradeChannelID,\n\t\tTradeNameID,\n\t\tOperationalRegionID,\n\t\tMarketTypeID,\n\t\tCACCustomer,\n\t\tDirectIndicator,\n\t\tIsActive,\n\t\tSR_CODE,\n\t\tSR_Name,\n\t\tDSM_Code,\n\t\tDSM_Name,\n\t\tSM_Code,\n\t\tSM_Name,\n\t\tGM_Code,\n\t\tGM_Name,\n\t\tGM_Desc\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SinkToData"
				}
			},
			"dependsOn": []
		}
	]
}